<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>魔法少女適性診断 ／人◕ ‿‿ ◕人＼</title>
    <style>
        :root {
            --qb-white: #ffffff;
            --qb-gray: #f8f9fa;
            --qb-pink: #ff8eb5;
            --qb-red: #e60012;
            --qb-text: #444444;
            --gem-color: var(--qb-pink);
            --corruption-op: 0;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            background-color: var(--qb-gray);
            color: var(--qb-text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: black;
            opacity: var(--corruption-op);
            pointer-events: none;
            z-index: 5;
            transition: opacity 1s ease;
        }

        .progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 6px; background-color: #eee; z-index: 100; }
        #progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--qb-pink), var(--qb-red)); transition: width 0.3s ease; }

        .container {
            background: var(--qb-white);
            padding: 2rem;
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 85%;
            text-align: center;
            border: 1.5px solid rgba(255, 142, 181, 0.2);
            transition: all 0.5s ease;
            position: relative;
            z-index: 10;
        }

        .aura-active { box-shadow: 0 0 40px 10px var(--gem-color); border-color: var(--gem-color); }

        h1 { color: var(--qb-red); font-size: 1.4rem; margin-bottom: 0.5rem; }
        .sub-p { font-size: 0.85rem; margin-bottom: 1.5rem; color: #666; }

        .button-group { display: flex; flex-direction: column; align-items: center; gap: 10px; margin-top: 15px; }

        .btn {
            display: inline-block;
            width: 100%;
            max-width: 280px;
            padding: 12px 20px;
            background-color: var(--qb-white);
            color: var(--qb-pink);
            border: 2px solid var(--qb-pink);
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: bold;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            outline: none;
            text-decoration: none;
        }

        .btn:hover { background-color: var(--qb-pink); color: var(--qb-white); transform: translateY(-2px); }
        .btn:active { transform: translateY(1px) scale(0.98); }
        .btn-secondary { border-color: #d1d1d1; color: #888; }
        .btn-back { border-color: #ffb6c1; color: #ffb6c1; margin-top: 5px; font-size: 0.85rem; padding: 8px 15px; width: auto; }

        .question { font-size: 1.1rem; margin: 20px 0; font-weight: bold; line-height: 1.5; min-height: 3.5rem; display: flex; align-items: center; justify-content: center; color: #222; }
        
        #result { font-size: 1.8rem; margin: 15px 0; font-weight: bold; }
        #result-desc { background: rgba(255, 255, 255, 0.8); padding: 18px; border-radius: 15px; border: 1px dashed var(--gem-color); margin-bottom: 20px; text-align: left; line-height: 1.6; font-size: 0.9rem; }
        
        .hidden { display: none !important; }

        /* デバッグパネルを強化 */
        #debug-panel {
            margin-top: 15px;
            padding: 15px;
            background: #1a1a1a;
            color: #00ff41;
            font-family: 'Courier New', monospace;
            font-size: 0.7rem;
            text-align: left;
            border-radius: 10px;
            border: 1px solid #00ff41;
            line-height: 1.4;
            animation: fadeIn 0.5s forwards;
        }

        .ripple { position: absolute; border-radius: 50%; background: rgba(255, 255, 255, 0.6); transform: scale(0); animation: ripple-animation 0.5s linear; pointer-events: none; }
        @keyframes ripple-animation { to { transform: scale(4); opacity: 0; } }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.2s ease-in-out 2; }
    </style>
</head>
<body>

<div class="progress-container"><div id="progress-bar"></div></div>

<div class="container fade-in" id="main-container">
    <div id="menu">
        <h1>魔法少女適性診断</h1>
        <p class="sub-p">「君がどんな願いを叶えるのか、僕に教えてよ」</p>
        <div class="button-group">
            <button class="btn ripple-btn" onclick="startQuiz(15)">お手軽診断 (15問)</button>
            <button class="btn ripple-btn" onclick="startQuiz(30)">本格診断 (30問)</button>
            <a href="index.html" class="btn btn-secondary ripple-btn">出羽鯖に戻る</a>
        </div>
    </div>

    <div id="quiz-screen" class="hidden">
        <div id="progress-text" style="font-size: 0.75rem; color: #999;"></div>
        <div class="question" id="question-text"></div>
        <div class="button-group">
            <button class="btn ripple-btn" onclick="handleAnswer(2)">とても思う</button>
            <button class="btn ripple-btn" onclick="handleAnswer(1)">まあまあ思う</button>
            <button class="btn ripple-btn" onclick="handleAnswer(-1)">あまり思わない</button>
            <button class="btn ripple-btn" onclick="handleAnswer(-2)">全く思わない</button>
            <button id="back-btn" class="btn btn-secondary btn-back ripple-btn hidden" onclick="goBack()">一つ前に戻る</button>
        </div>
    </div>

    <div id="result-screen" class="hidden">
        <p id="result-intro" style="font-size: 0.8rem; color: #888;">君の魂が放つ光の色は……</p>
        <div id="result"></div>
        <div id="result-desc"></div>
        <div class="button-group" id="result-buttons">
            <button class="btn ripple-btn" onclick="location.reload()">もう一度診断する</button>
            <a href="index.html" class="btn btn-secondary ripple-btn">出羽鯖に戻る</a>
        </div>
    </div>
</div>

<script>
// 質問リストを35問に増やしたよ。これで30問診断もバッチリだ。
    const questions = [
        { text: "困っている人を見たら、放っておけない。", x: 3, y: -1, z: 2 },
        { text: "目的のためなら、自分が傷ついても構わない。", x: -1, y: 2, z: 1 },
        { text: "過去にやり直したい強い後悔がある。", x: -1, y: 1, z: -3 },
        { text: "正義感は人一倍強い方だと思う。", x: 2, y: -2, z: 1 },
        { text: "自分の才能は、誰かのために使うべきだ。", x: 3, y: 0, z: 2 },
        { text: "孤独でいるより、仲間と一緒に戦いたい。", x: 1, y: -2, z: 1 },
        { text: "感情よりも理性を優先して行動する。", x: 0, y: 3, z: 0 },
        { text: "憧れの人の背中を追い続けている。", x: 2, y: -1, z: 2 },
        { text: "大切な人を守るなら世界を敵に回してもいい。", x: -2, y: 2, z: 1 },
        { text: "願いが叶うなら、どんな代償も払う覚悟だ。", x: -2, y: 3, z: -1 },
        { text: "他人の幸せが自分の幸せだと思える。", x: 3, y: -2, z: 2 },
        { text: "奇跡は起きるものだと信じている。", x: 1, y: -2, z: 3 },
        { text: "自分の居場所を見つけるのは難しい。", x: 0, y: 1, z: -2 },
        { text: "正しいことをしたはずなのに、報われないと感じる。", x: 1, y: -1, z: -2 },
        { text: "たった一人の理解者がいれば、それでいい。", x: -1, y: -1, z: 1 },
        { text: "感情的になるのは弱さの証だと思う。", x: -1, y: 3, z: -1 },
        { text: "誰からも忘れ去られるのが一番怖い。", x: 1, y: 0, z: -3 },
        { text: "自分の信念のためなら孤立しても構わない。", x: -2, y: 1, z: 1 },
        { text: "世界は残酷で、不平等にできている。", x: -1, y: 2, z: -2 },
        { text: "他人に甘えるのは苦手だ。", x: -1, y: 2, z: 1 },
        { text: "食欲や睡眠など、自分の欲求に正直な方だ。", x: -2, y: -2, z: 1 },
        { text: "「いつかきっと報われる」という言葉は綺麗事だと思う。", x: -1, y: 2, z: -3 },
        { text: "一度決めたことは、何があっても曲げたくない。", x: -1, y: 1, z: 2 },
        { text: "周囲の期待に応えるために、自分を演じることがある。", x: 1, y: 2, z: -1 },
        { text: "愛は、最終的に呪いと同じものだと思う。", x: -1, y: 0, z: -2 },
        { text: "自分には、他にはない特別な役割があると感じる。", x: 1, y: 1, z: 2 },
        { text: "誰かの犠牲の上に成り立つ平和は間違っている。", x: 3, y: -1, z: 1 },
        { text: "裏切りを経験しても、もう一度人を信じたい。", x: 2, y: -2, z: 3 },
        { text: "論理的に説明できないことは信じない。", x: 0, y: 3, z: 0 },
        { text: "「さよなら」を言うときは、いつも一人でいい。", x: -2, y: 1, z: -1 },
        { text: "たとえ神様が相手でも、文句を言ってやりたい。", x: -1, y: -2, z: 1 },
        { text: "日常の平和こそが、何よりも守るべき価値だ。", x: 2, y: -1, z: 2 },
        { text: "自分の弱さを他人に見せるのは恥ずかしい。", x: -1, y: 2, z: -1 },
        { text: "奇跡を待つより、自分の力で奪い取りたい。", x: -2, y: -1, z: 2 },
        { text: "死そのものより、無意味に生きる方が怖い。", x: -1, y: 2, z: -1 }
    ];

const characters = {
        madoka: { name: "鹿目 まどか", x: 12, y: -2, z: 12, color: "#ffc0cb", desc: "君はとても優しくて、友達思いだね。君の中には宇宙の運命さえ変えてしまえるほどの可能性があるよ。" },
        homura: { name: "暁美 ほむら", x: -10, y: 12, z: -4, color: "#da70d6", desc: "冷静で意志が強いんだね。大切なものを守りたいという切実な願いを、君は心に秘めている。" },
        sayaka: { name: "美樹 さやか", x: 10, y: -12, z: -8, color: "#4169e1", desc: "正義感が強くて真っ直ぐだね。でも、その純粋さが自分を追い詰めないように気をつけて。" },
        mami:   { name: "巴 マミ",   x: 6, y: 6, z: 4, color: "#ffd700", desc: "気高くて頼りがいのあるお姉さん。本当は温かな繋がりを誰よりも求めているんじゃないかな。" },
        kyoko:  { name: "佐倉 杏子", x: -12, y: -10, z: 4, color: "#ff4500", desc: "ドライに見えて実は情に厚い。厳しい世界を生き抜いてきた君の強さは、本物だよ。" },
        kyubey: { name: "キュゥべえ", x: 0, y: 25, z: 0, color: "#999", desc: "君からは感情の揺らぎが感じられない。僕たちと同じ観測者側の素質があるみたいだね。" }
    };

    let pos = { x: 0, y: 0, z: 0 };
    let quizSet = [];
    let currentIdx = 0;
    let history = [];
    let inputBuffer = "";
    const secretCommand = "magica";

    function startQuiz(num) {
        document.getElementById('menu').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        quizSet = [...questions].sort(() => 0.5 - Math.random()).slice(0, num);
        currentIdx = 0;
        pos = { x: 0, y: 0, z: 0 };
        history = [];
        updateUI();
    }

    function handleAnswer(m) {
        history.push({ pos: {...pos} });
        const q = quizSet[currentIdx];
        pos.x += q.x * m;
        pos.y += q.y * m;
        pos.z += q.z * m;
        const corruption = Math.min(Math.max(-pos.z / 40, 0), 0.8);
        document.documentElement.style.setProperty('--corruption-op', corruption);
        currentIdx++;
        if (currentIdx < quizSet.length) { updateUI(); } else { showResult(); }
    }

    function goBack() {
        if (currentIdx > 0) {
            currentIdx--;
            pos = history.pop().pos;
            updateUI();
        }
    }

    function updateUI() {
        const percent = (currentIdx / quizSet.length) * 100;
        document.getElementById('progress-bar').style.width = percent + "%";
        document.getElementById('progress-text').innerText = `進捗率: ${Math.round(percent)}%`;
        document.getElementById('question-text').innerText = quizSet[currentIdx].text;
        const backBtn = document.getElementById('back-btn');
        currentIdx > 0 ? backBtn.classList.remove('hidden') : backBtn.classList.add('hidden');
    }

    function showResult() {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        
        let winner = "madoka";
        let minDist = Infinity;

        if (pos.z < -25) {
            winner = "special";
        } else {
            for (let k in characters) {
                const c = characters[k];
                const d = Math.sqrt((pos.x-c.x)**2 + (pos.y-c.y)**2 + (pos.z-c.z)**2);
                if (d < minDist) { minDist = d; winner = k; }
            }
        }

const res = winner === "special" ? { 
        name: "測定不能 (計測エラー)", 
        color: "#222", 
        desc: "おや、計測不能だ。君の魂の出力は僕の予測を超えてしまったみたいだね。……いずれ、この意味がわかる時が来るはずだよ。それまでは、君らしくその日々を過ごすといい。" 
    } : characters[winner];

    document.getElementById('result').innerText = res.name;
    document.getElementById('result').style.color = res.color;
    document.getElementById('result-desc').innerText = res.desc;
    
    // エラー時はより禍々しい「黒に近い紫」のオーラを放つ演出
    const auraColor = winner === "special" ? "#2e0854" : res.color;
    document.documentElement.style.setProperty('--gem-color', auraColor);
    document.getElementById('main-container').classList.add('aura-active');
}

    // 隠しコマンド監視
    document.addEventListener('keydown', (e) => {
        if (document.getElementById('result-screen').classList.contains('hidden')) return;
        inputBuffer += e.key.toLowerCase();
        if (inputBuffer.length > secretCommand.length) inputBuffer = inputBuffer.slice(-secretCommand.length);
        
        if (inputBuffer === secretCommand) {
            if (document.getElementById('debug-panel')) return;
            
            const panel = document.createElement('div');
            panel.id = 'debug-panel';
            
            // 各キャラとの距離を計算
            let distData = "";
            for (let k in characters) {
                const c = characters[k];
                const d = Math.sqrt((pos.x-c.x)**2 + (pos.y-c.y)**2 + (pos.z-c.z)**2);
                // 距離が短いほど「近い」
                distData += `${k.padEnd(8)}: dist ${d.toFixed(2)}<br>`;
            }

            panel.innerHTML = `
                <div style="border-bottom:1px solid #0f0; margin-bottom:5px; font-weight:bold;">[SOUL_VECTOR_ANALYSIS]</div>
                <div>X(利他): ${pos.x} | Y(理性): ${pos.y} | Z(希望): ${pos.z}</div>
                <div style="margin-top:8px; color: #8f8;">PROXIMITY_LIST:</div>
                <div style="font-size:0.65rem;">${distData}</div>
                <div style="margin-top:5px; font-size:0.6rem; color: #666;">※distが小さいほど適性が高い</div>
            `;
            document.getElementById('result-buttons').before(panel);
            document.getElementById('main-container').classList.add('shake');
        }
    });

    // クリックエフェクト
    document.addEventListener('click', function (e) {
        if (e.target.classList.contains('ripple-btn')) {
            const btn = e.target;
            const ripple = document.createElement('span');
            const rect = btn.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = e.clientX - rect.left - size / 2 + 'px';
            ripple.style.top = e.clientY - rect.top - size / 2 + 'px';
            ripple.classList.add('ripple');
            btn.appendChild(ripple);
            setTimeout(() => ripple.remove(), 500);
        }
    });
</script>

</body>
</html>


